<div id="panel-11" class="panel">
    <div class="panel-hdr">
        <h2>Menu</h2>
        <div class="panel-toolbar">
            <button class="btn btn-panel waves-effect waves-themed" data-action="panel-collapse" data-toggle="tooltip" data-offset="0,10" data-original-title="Collapse"></button>
            <button class="btn btn-panel waves-effect waves-themed" data-action="panel-fullscreen" data-toggle="tooltip" data-offset="0,10" data-original-title="Fullscreen"></button>
            <button class="btn btn-panel waves-effect waves-themed" data-action="panel-close" data-toggle="tooltip" data-offset="0,10" data-original-title="Close"></button>
        </div>
    </div>
    <div class="panel-container show">
        <div class="panel-content">
            <div class="panel-tag">
                Pilih Menu yang akan diakses.
            </div>
            <div class="card-deck">
                <div class="col-xl-3" style="padding-top: 30px">
                    <div class="card">
                        <div class="w-100 bg-fusion-50 rounded-top">
                            <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-bottom: 0px;">
                                <!-- <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true"><i class="fal fa-times"></i></span>
                                </button> -->
                                <div class="d-flex align-items-center">
                                    <div class="alert-icon">
                                        <i class="fal fa-file-invoice"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h2>LAPORAN ANALISA</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                        </div>
                        <div class="card-footer d-flex justify-content-end">
                            <a href="#" onclick="loadPage('Administrasi/li')">
                                <button type="button" class="btn btn-lg btn-success waves-effect waves-themed">
                                    MASUK
                                    <span class="fal fa-angle-double-right mr-1"></span>
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3" style="padding-top: 30px">
                    <div class="card">
                        <div class="w-100 bg-fusion-50 rounded-top">
                            <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-bottom: 0px;">
                                <!-- <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true"><i class="fal fa-times"></i></span>
                                </button> -->
                                <div class="d-flex align-items-center">
                                    <div class="alert-icon">
                                        <i class="fal fa-file-invoice"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h2>LPPI</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                        </div>
                        <div class="card-footer d-flex justify-content-end">
                            <a href="#" onclick="loadPage('Administrasi/lppi')">
                                <button type="button" class="btn btn-lg btn-success waves-effect waves-themed">
                                    MASUK
                                    <span class="fal fa-angle-double-right mr-1"></span>
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3" style="padding-top: 30px">
                    <div class="card">
                        <div class="w-100 bg-fusion-50 rounded-top">
                            <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-bottom: 0px;">
                                <!-- <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true"><i class="fal fa-times"></i></span>
                                </button> -->
                                <div class="d-flex align-items-center">
                                    <div class="alert-icon">
                                        <i class="fal fa-file-invoice"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h2>LKAI</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                        </div>
                        <div class="card-footer d-flex justify-content-end">
                            <a href="#" onclick="loadPage('Administrasi/lkai')" id="LKAI">
                                <button type="button" class="btn btn-lg btn-success waves-effect waves-themed">
                                    MASUK
                                    <span class="fal fa-angle-double-right mr-1"></span>
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3" style="padding-top: 30px">
                    <div class="card">
                        <div class="w-100 bg-fusion-50 rounded-top">
                            <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-bottom: 0px;">
                                <!-- <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true"><i class="fal fa-times"></i></span>
                                </button> -->
                                <div class="d-flex align-items-center">
                                    <div class="alert-icon">
                                        <i class="fal fa-file-invoice"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h2>NHI</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                        </div>
                        <div class="card-footer d-flex justify-content-end">
                            <a href="#" id="NHI">
                                <button type="button" class="btn btn-lg btn-success waves-effect waves-themed">
                                    MASUK
                                    <span class="fal fa-angle-double-right mr-1"></span>
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-xl-12" style="padding-top: 30px">
                    <div class="card">
                        <div class="w-100 bg-fusion-50 rounded-top">
                            <div class="alert alert-info alert-dismissible fade show" role="alert" style="margin-bottom: 0px;">
                                <!-- <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true"><i class="fal fa-times"></i></span>
                                </button> -->
                                <div class="d-flex align-items-center">
                                    <div class="alert-icon">
                                        <i class="fal fa-file-invoice"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h2>LEMBAR MONITORING INFORMASI</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                        </div>
                        <div class="card-footer d-flex justify-content-end">
                            <a href="javascript:void(0)" onclick="loadPage('Administrasi/lmi')">
                                <button type="button" class="btn btn-lg btn-success waves-effect waves-themed">
                                    MASUK
                                    <span class="fal fa-angle-double-right mr-1"></span>
                                </button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalLki" tabindex="-1" role="dialog" aria-modal="true" data-backdrop="false">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="fal fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">   
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect waves-themed" id="back" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary waves-effect waves-themed" id="simpan">Simpan</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
    var yyyy = today.getFullYear();

    today = yyyy + '/' + mm + '/' + dd;
    $(document).ready(function(){
        var newLI;
        var year = new Date().getFullYear();

        $(':input').inputmask();
        $('[name="NOMOR_LI"]').inputmask({mask: "LI-9{1,3}/WBC.0\\9/KPP.MP.0702/"+year, gready: false});
        var controls = {
            leftArrow: '<i class="fal fa-angle-left" style="font-size: 1.25rem"></i>',
            rightArrow: '<i class="fal fa-angle-right" style="font-size: 1.25rem"></i>'
        }
        var pegawaiUrl = "Pegawai/getPegawaiByName"
        $('.tanggal').datepicker({
            language: "id",
            format: "yyyy-mm-dd",
            orientation: "bottom right",
            todayHighlight: true,
            templates: controls
        });

        $('[name="PENYUSUN"]').select2({
            placeholder: 'Ketik Nama Penyusun LI',
            dropdownParent: $('[name="PENYUSUN"]').parent(),
            minimumInputLength: 3,
            allowClear: true,
            ajax : {
                url : pegawaiUrl,
                dataType : "JSON",
                delay : 250,
                data : function(params){
                    return{
                        name : params.term
                    };
                },
                processResults: function(data){
                    // console.log(data);
                    var results = [];

                    $.each(data, function(index, item){
                        results.push({
                            id : item.NIPPegawai,
                            text : item.NamaPegawai
                        })
                    });
                    return{
                        results : results
                    };
                },
                cache : true
            }
        });

        $('[name="TUJUAN_DISPOSISI"]').select2({
            placeholder: 'Ketik Nama Penerima Disposisi',
            dropdownParent: $('[name="TUJUAN_DISPOSISI"]').parent(),
            minimumInputLength: 3,
            allowClear: true,
            ajax : {
                url : pegawaiUrl,
                dataType : "JSON",
                delay : 250,
                data : function(params){
                    return{
                        name : params.term
                    };
                    // console.log(params);
                },
                processResults: function(data){
                    // console.log(data);
                    var results = [];

                    $.each(data, function(index, item){
                        results.push({
                            id : item.NIPPegawai,
                            text : item.NamaPegawai
                        })
                    });
                    return{
                        results : results
                    };
                },
                cache : true
            }
        });

        $('[name="PEJABAT_TTD"]').select2({
            placeholder: 'Ketik Nama Kasubsi Intelijen',
            dropdownParent: $('[name="PEJABAT_TTD"]').parent(),
            minimumInputLength: 3,
            allowClear: true,
            ajax : {
                url : pegawaiUrl,
                dataType : "JSON",
                delay : 250,
                data : function(params){
                    return{
                        name : params.term
                    };
                    // console.log(params);
                },
                processResults: function(data){
                    // console.log(data);
                    var results = [];

                    $.each(data, function(index, item){
                        results.push({
                            id : item.NIPPegawai,
                            text : item.NamaPegawai
                        })
                    });
                    return{
                        results : results
                    };
                },
                cache : true
            }
        });
    });

    // LEMBAR INFORMASI FUNCTION
    $("#LI").on('click', function(event) {
        event.preventDefault();
        /* Act on the event */
        getLastLINumber("LI");
        $('[name="TANGGAL_LI"]').val(today);
        $(".modal-title").text('Input Data Lembar Informasi')
        $("#modalLi").modal('show');
    });

    function getLastLINumber(doc){
        $.ajax({
            url: 'Administrasi/getNomorLi',
            type: 'GET',
            dataType: 'JSON',
            data: {tahun: new Date().getFullYear(), type: doc},
            success: function(d){
                $('[name="NOMOR_LI"]').val(d);
            }
        })
    }

    $('[name="PEJABAT_TTD"], [name="PENYUSUN"]').on('select2:select', function(e) {
        var sasaran;
        el = this.getAttribute('name');
        if (el == "PEJABAT_TTD") {
            sasaran = "NIP_PEJABAT_TTD";
        } else {
            sasaran = "NIP_PENYUSUN";
        }

        $('[name="'+sasaran+'"]').val(e.params.data.id);
    });

    $("#LKI").on('click', function(event) {
        event.preventDefault();
        /* Act on the event */
        $(".modal-title").text('Input Data Lembar Klasifikasi Informasi')
        $("#modalLki").modal('show');
    });

    function post(form){
        var usedForm = "#"+form;
        
        if ($(usedForm)[0].checkValidity() === false ) {
            play = document.getElementById('notification');
            $(usedForm).addClass('was-validated');
            toastr.error('Isi Form Dengan Lengkap dan Benar','Gagal');
            play.play();
            delete play;
        } else {
            var data = $(usedForm).serializeArray();
            data[data.length] = {name: 'FORM', value: form};
            console.log(data);
            $.ajax({
                url: 'Administrasi/postDataIntelijen',
                type: 'POST',
                dataType: 'JSON',
                data: data,
                success: function(d){
                    play = document.getElementById('notification');
                    if (d.status == 'success') {
                        toastr.success(d.pesan,'Berhasil');
                    } else {
                        toastr.error(d.pesan,'Gagal');
                    }
                    
                    play.play();
                    delete play;
                    $("#modalForm").modal('hide');
                }
            })
        }      
    }

</script>